<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE jasperReport PUBLIC "-//JasperReports//DTD Report Design//EN" "http://jasperreports.sourceforge.net/dtds/jasperreport.dtd">
<jasperReport name="revenue_time" pageWidth="842" pageHeight="595" orientation="Landscape" columnWidth="782" leftMargin="30" rightMargin="30" topMargin="20" bottomMargin="20" whenNoDataType="AllSectionsNoDetail" isSummaryNewPage="true">
    <property name="net.sf.jasperreports.default.font.name" value="DejaVu Sans"/>
    <property name="net.sf.jasperreports.default.pdf.font.name" value="DejaVu Sans"/>
    <property name="net.sf.jasperreports.default.pdf.encoding" value="Identity-H"/>
    <property name="net.sf.jasperreports.default.pdf.embedded" value="true"/>
    <style name="BaseStyle" isDefault="true" fontName="DejaVu Sans" pdfFontName="net/sf/jasperreports/fonts/dejavu/DejaVuSans.ttf" pdfEncoding="Identity-H" isPdfEmbedded="true"/>
    <parameter name="REPORT_TITLE" class="java.lang.String"/>
    <parameter name="printedDate" class="java.lang.String"/>
    <parameter name="printedBy" class="java.lang.String"/>
    <parameter name="fromDate" class="java.lang.String"/>
    <parameter name="toDate" class="java.lang.String"/>
    <parameter name="reportCode" class="java.lang.String"/>
    <parameter name="LOGO_STREAM" class="java.io.InputStream"/>

    <field name="date" class="java.lang.String"/>
    <field name="totalRevenue" class="java.math.BigDecimal"/>
    <field name="transactionCount" class="java.lang.Long"/>
    <field name="successCount" class="java.lang.Long"/>
    <field name="failCount" class="java.lang.Long"/>
    <field name="successRate" class="java.lang.Double"/>
    <field name="note" class="java.lang.String"/>

    <variable name="vTotalRevenue" class="java.math.BigDecimal" resetType="Report" calculation="Sum">
        <variableExpression><![CDATA[$F{totalRevenue} == null ? java.math.BigDecimal.ZERO : $F{totalRevenue}]]></variableExpression>
    </variable>
    <variable name="vTotalTransactions" class="java.lang.Long" resetType="Report" calculation="Sum">
        <variableExpression><![CDATA[$F{transactionCount} == null ? 0L : $F{transactionCount}]]></variableExpression>
    </variable>
    <variable name="vTotalSuccess" class="java.lang.Long" resetType="Report" calculation="Sum">
        <variableExpression><![CDATA[$F{successCount} == null ? 0L : $F{successCount}]]></variableExpression>
    </variable>
    <variable name="vTotalFail" class="java.lang.Long" resetType="Report" calculation="Sum">
        <variableExpression><![CDATA[$F{failCount} == null ? 0L : $F{failCount}]]></variableExpression>
    </variable>

    <title>
        <band height="80">
            <image scaleImage="RetainShape">
                <reportElement x="0" y="0" width="80" height="30"/>
                <imageExpression><![CDATA[$P{LOGO_STREAM}]]></imageExpression>
            </image>
            <textField>
                <reportElement x="90" y="0" width="692" height="30"/>
                <textElement textAlignment="Center" verticalAlignment="Middle">
                    <font size="16" isBold="true"/>
                </textElement>
                <textFieldExpression><![CDATA[$P{REPORT_TITLE}]]></textFieldExpression>
            </textField>

            <textField>
                <reportElement x="0" y="35" width="260" height="15"/>
                <textElement>
                    <font size="9"/>
                </textElement>
                <textFieldExpression><![CDATA["Ngày xuất báo cáo: " + ($P{printedDate} == null ? "" : $P{printedDate})]]></textFieldExpression>
            </textField>
            <textField>
                <reportElement x="260" y="35" width="260" height="15"/>
                <textElement>
                    <font size="9"/>
                </textElement>
                <textFieldExpression><![CDATA["Người thực hiện: " + ($P{printedBy} == null ? "" : $P{printedBy})]]></textFieldExpression>
            </textField>
            <textField>
                <reportElement x="520" y="35" width="262" height="15"/>
                <textElement textAlignment="Right">
                    <font size="9"/>
                </textElement>
                <textFieldExpression><![CDATA["Mã báo cáo: " + ($P{reportCode} == null ? "" : $P{reportCode})]]></textFieldExpression>
            </textField>

            <textField>
                <reportElement x="0" y="55" width="400" height="15"/>
                <textElement>
                    <font size="9"/>
                </textElement>
                <textFieldExpression><![CDATA["Khoảng thời gian: " + ($P{fromDate} == null ? "" : $P{fromDate}) + " - " + ($P{toDate} == null ? "" : $P{toDate})]]></textFieldExpression>
            </textField>
        </band>
    </title>

    <columnHeader>
        <band height="24">
            <rectangle>
                <reportElement x="0" y="0" width="782" height="24" backcolor="#F5F7FA" mode="Opaque"/>
            </rectangle>
            <staticText>
                <reportElement x="0" y="0" width="90" height="24"/>
                <textElement textAlignment="Left" verticalAlignment="Middle"><font isBold="true"/></textElement>
                <text><![CDATA[Ngày]]></text>
            </staticText>
            <staticText>
                <reportElement x="90" y="0" width="110" height="24"/>
                <textElement textAlignment="Right" verticalAlignment="Middle"><font isBold="true"/></textElement>
                <text><![CDATA[Tổng giao dịch]]></text>
            </staticText>
            <staticText>
                <reportElement x="200" y="0" width="110" height="24"/>
                <textElement textAlignment="Right" verticalAlignment="Middle"><font isBold="true"/></textElement>
                <text><![CDATA[Thành công]]></text>
            </staticText>
            <staticText>
                <reportElement x="310" y="0" width="110" height="24"/>
                <textElement textAlignment="Right" verticalAlignment="Middle"><font isBold="true"/></textElement>
                <text><![CDATA[Thất bại]]></text>
            </staticText>
            <staticText>
                <reportElement x="420" y="0" width="120" height="24"/>
                <textElement textAlignment="Right" verticalAlignment="Middle"><font isBold="true"/></textElement>
                <text><![CDATA[Tỉ lệ thành công (%)]]></text>
            </staticText>
            <staticText>
                <reportElement x="540" y="0" width="140" height="24"/>
                <textElement textAlignment="Right" verticalAlignment="Middle"><font isBold="true"/></textElement>
                <text><![CDATA[Doanh thu (VNĐ)]]></text>
            </staticText>
            <staticText>
                <reportElement x="680" y="0" width="102" height="24"/>
                <textElement textAlignment="Left" verticalAlignment="Middle"><font isBold="true"/></textElement>
                <text><![CDATA[Ghi chú]]></text>
            </staticText>
        </band>
    </columnHeader>

    <detail>
        <band height="20">
            <rectangle>
                <reportElement x="0" y="0" width="782" height="20"/>
            </rectangle>
            <textField>
                <reportElement x="0" y="0" width="90" height="20"/>
                <textElement verticalAlignment="Middle"/>
                <textFieldExpression><![CDATA[$F{date}]]></textFieldExpression>
            </textField>
            <textField pattern="#,##0">
                <reportElement x="90" y="0" width="110" height="20"/>
                <textElement textAlignment="Right" verticalAlignment="Middle"/>
                <textFieldExpression><![CDATA[$F{transactionCount} == null ? 0L : $F{transactionCount}]]></textFieldExpression>
            </textField>
            <textField pattern="#,##0">
                <reportElement x="200" y="0" width="110" height="20"/>
                <textElement textAlignment="Right" verticalAlignment="Middle"/>
                <textFieldExpression><![CDATA[$F{successCount} == null ? 0L : $F{successCount}]]></textFieldExpression>
            </textField>
            <textField pattern="#,##0">
                <reportElement x="310" y="0" width="110" height="20"/>
                <textElement textAlignment="Right" verticalAlignment="Middle"/>
                <textFieldExpression><![CDATA[$F{failCount} == null ? 0L : $F{failCount}]]></textFieldExpression>
            </textField>
            <textField pattern="#0.00'%'">
                <reportElement x="420" y="0" width="120" height="20"/>
                <textElement textAlignment="Right" verticalAlignment="Middle"/>
                <textFieldExpression><![CDATA[($F{successRate} == null ? 0.0 : $F{successRate})]]></textFieldExpression>
            </textField>
            <textField pattern="#,##0">
                <reportElement x="540" y="0" width="140" height="20"/>
                <textElement textAlignment="Right" verticalAlignment="Middle"/>
                <textFieldExpression><![CDATA[$F{totalRevenue} == null ? java.math.BigDecimal.ZERO : $F{totalRevenue}]]></textFieldExpression>
            </textField>
            <textField>
                <reportElement x="680" y="0" width="102" height="20"/>
                <textElement verticalAlignment="Middle"/>
                <textFieldExpression><![CDATA[$F{note} == null ? "" : $F{note}]]></textFieldExpression>
            </textField>
        </band>
    </detail>

    <columnFooter>
        <band height="20">
            <rectangle>
                <reportElement x="0" y="0" width="782" height="20" backcolor="#E9F2FF" mode="Opaque"/>
            </rectangle>
            <staticText>
                <reportElement x="0" y="0" width="90" height="20"/>
                <textElement verticalAlignment="Middle">
                    <font size="9" isBold="true"/>
                </textElement>
                <text><![CDATA[Tổng]]></text>
            </staticText>
            <textField pattern="#,##0">
                <reportElement x="90" y="0" width="110" height="20"/>
                <textElement textAlignment="Right" verticalAlignment="Middle"/>
                <textFieldExpression><![CDATA[$V{vTotalTransactions} == null ? 0L : $V{vTotalTransactions}]]></textFieldExpression>
            </textField>
            <textField pattern="#,##0">
                <reportElement x="200" y="0" width="110" height="20"/>
                <textElement textAlignment="Right" verticalAlignment="Middle"/>
                <textFieldExpression><![CDATA[$V{vTotalSuccess} == null ? 0L : $V{vTotalSuccess}]]></textFieldExpression>
            </textField>
            <textField pattern="#,##0">
                <reportElement x="310" y="0" width="110" height="20"/>
                <textElement textAlignment="Right" verticalAlignment="Middle"/>
                <textFieldExpression><![CDATA[$V{vTotalFail} == null ? 0L : $V{vTotalFail}]]></textFieldExpression>
            </textField>
            <textField pattern="#0.00'%'">
                <reportElement x="420" y="0" width="120" height="20"/>
                <textElement textAlignment="Right" verticalAlignment="Middle"/>
                <textFieldExpression><![CDATA[
                    ($V{vTotalTransactions} == null || $V{vTotalTransactions}.longValue() == 0L)
                        ? 0.0
                        : ($V{vTotalSuccess}.doubleValue() * 100.0 / $V{vTotalTransactions}.doubleValue())
                ]]></textFieldExpression>
            </textField>
            <textField pattern="#,##0">
                <reportElement x="540" y="0" width="140" height="20"/>
                <textElement textAlignment="Right" verticalAlignment="Middle"/>
                <textFieldExpression><![CDATA[$V{vTotalRevenue} == null ? java.math.BigDecimal.ZERO : $V{vTotalRevenue}]]></textFieldExpression>
            </textField>
        </band>
    </columnFooter>

    <pageFooter>
        <band height="40">
            <textField>
                <reportElement x="0" y="0" width="120" height="14"/>
                <textElement verticalAlignment="Middle">
                    <font size="9"/>
                </textElement>
                <textFieldExpression><![CDATA["Trang " + $V{PAGE_NUMBER} + " /"]]></textFieldExpression>
            </textField>
            <textField evaluationTime="Report">
                <reportElement x="120" y="0" width="30" height="14"/>
                <textElement verticalAlignment="Middle">
                    <font size="9"/>
                </textElement>
                <textFieldExpression><![CDATA[$V{PAGE_NUMBER}]]></textFieldExpression>
            </textField>
            <textField>
                <reportElement x="350" y="0" width="432" height="14"/>
                <textElement textAlignment="Right" verticalAlignment="Middle">
                    <font size="9"/>
                </textElement>
                <textFieldExpression><![CDATA["Xuất ngày: " + ($P{printedDate} == null ? "" : $P{printedDate})]]></textFieldExpression>
            </textField>
            <staticText>
                <reportElement x="0" y="16" width="400" height="12"/>
                <textElement verticalAlignment="Middle">
                    <font size="9"/>
                </textElement>
                <text><![CDATA[Báo cáo doanh thu BC-DT-001 – Version 1.0]]></text>
            </staticText>
            <staticText>
                <reportElement x="0" y="28" width="400" height="12"/>
                <textElement verticalAlignment="Middle">
                    <font size="9"/>
                </textElement>
                <text><![CDATA[© 2025 – Hệ thống đặt vé xe]]></text>
            </staticText>
        </band>
    </pageFooter>

    <summary>
        <band height="555">
            <frame>
                <reportElement x="0" y="10" width="782" height="70"/>

                <frame>
                    <reportElement x="0" y="0" width="390" height="35"/>
                    <staticText>
                        <reportElement x="0" y="0" width="390" height="15"/>
                        <textElement><font isBold="true" size="10"/></textElement>
                        <text><![CDATA[Tổng doanh thu (VNĐ)]]></text>
                    </staticText>
                    <textField pattern="#,##0">
                        <reportElement x="0" y="18" width="390" height="17"/>
                        <textElement textAlignment="Right"><font size="10"/></textElement>
                        <textFieldExpression><![CDATA[$V{vTotalRevenue} == null ? java.math.BigDecimal.ZERO : $V{vTotalRevenue}]]></textFieldExpression>
                    </textField>
                </frame>

                <frame>
                    <reportElement x="392" y="0" width="390" height="35"/>
                    <staticText>
                        <reportElement x="0" y="0" width="390" height="15"/>
                        <textElement><font isBold="true" size="10"/></textElement>
                        <text><![CDATA[Tổng số giao dịch]]></text>
                    </staticText>
                    <textField pattern="#,##0">
                        <reportElement x="0" y="18" width="390" height="17"/>
                        <textElement textAlignment="Right"><font size="10"/></textElement>
                        <textFieldExpression><![CDATA[$V{vTotalTransactions} == null ? 0L : $V{vTotalTransactions}]]></textFieldExpression>
                    </textField>
                </frame>

                <frame>
                    <reportElement x="0" y="35" width="390" height="35"/>
                    <staticText>
                        <reportElement x="0" y="0" width="390" height="15"/>
                        <textElement><font isBold="true" size="10"/></textElement>
                        <text><![CDATA[Giao dịch thành công]]></text>
                    </staticText>
                    <textField pattern="#,##0">
                        <reportElement x="0" y="18" width="390" height="17"/>
                        <textElement textAlignment="Right"><font size="10"/></textElement>
                        <textFieldExpression><![CDATA[$V{vTotalSuccess} == null ? 0L : $V{vTotalSuccess}]]></textFieldExpression>
                    </textField>
                </frame>

                <frame>
                    <reportElement x="392" y="35" width="390" height="35"/>
                    <staticText>
                        <reportElement x="0" y="0" width="390" height="15"/>
                        <textElement><font isBold="true" size="10"/></textElement>
                        <text><![CDATA[Tỉ lệ thành công (%)]]></text>
                    </staticText>
                    <textField pattern="#0.00'%'">
                        <reportElement x="0" y="18" width="390" height="17"/>
                        <textElement textAlignment="Right"><font size="10"/></textElement>
                        <textFieldExpression><![CDATA[
                            ($V{vTotalTransactions} == null || $V{vTotalTransactions}.longValue() == 0L)
                                ? 0.0
                                : ($V{vTotalSuccess}.doubleValue() * 100.0 / $V{vTotalTransactions}.doubleValue())
                        ]]></textFieldExpression>
                    </textField>
                </frame>
            </frame>

            <lineChart>
                <chart>
                    <reportElement x="0" y="100" width="782" height="260"/>
                    <chartTitle>
                        <font size="11" isBold="true"/>
                        <titleExpression><![CDATA["Doanh thu theo thời gian"]]></titleExpression>
                    </chartTitle>
                </chart>
                <categoryDataset>
                    <dataset/>
                    <categorySeries>
                        <seriesExpression><![CDATA["Doanh thu"]]></seriesExpression>
                        <categoryExpression><![CDATA[$F{date}]]></categoryExpression>
                        <valueExpression><![CDATA[$F{totalRevenue} == null ? java.math.BigDecimal.ZERO : $F{totalRevenue}]]></valueExpression>
                    </categorySeries>
                </categoryDataset>
                <linePlot>
                    <plot/>
                    <categoryAxisLabelExpression><![CDATA["Ngày"]]></categoryAxisLabelExpression>
                    <valueAxisLabelExpression><![CDATA["Doanh thu (VNĐ)"]]></valueAxisLabelExpression>
                </linePlot>
            </lineChart>

            <!-- Manual footer for summary page (since pageFooter is not rendered on summary new page in this Jasper version) -->
            <frame>
                <reportElement x="0" y="515" width="782" height="40"/>
                <textField>
                    <reportElement x="0" y="0" width="120" height="14"/>
                    <textElement verticalAlignment="Middle">
                        <font size="9"/>
                    </textElement>
                    <textFieldExpression><![CDATA["Trang " + $V{PAGE_NUMBER} + " /"]]></textFieldExpression>
                </textField>
                <textField evaluationTime="Report">
                    <reportElement x="120" y="0" width="30" height="14"/>
                    <textElement verticalAlignment="Middle">
                        <font size="9"/>
                    </textElement>
                    <textFieldExpression><![CDATA[$V{PAGE_NUMBER}]]></textFieldExpression>
                </textField>
                <textField>
                    <reportElement x="350" y="0" width="432" height="14"/>
                    <textElement textAlignment="Right" verticalAlignment="Middle">
                        <font size="9"/>
                    </textElement>
                    <textFieldExpression><![CDATA["Xuất ngày: " + ($P{printedDate} == null ? "" : $P{printedDate})]]></textFieldExpression>
                </textField>
                <staticText>
                    <reportElement x="0" y="16" width="400" height="12"/>
                    <textElement verticalAlignment="Middle">
                        <font size="9"/>
                    </textElement>
                    <text><![CDATA[Báo cáo doanh thu BC-DT-001 – Version 1.0]]></text>
                </staticText>
                <staticText>
                    <reportElement x="0" y="28" width="400" height="12"/>
                    <textElement verticalAlignment="Middle">
                        <font size="9"/>
                    </textElement>
                    <text><![CDATA[© 2025 – Hệ thống đặt vé xe]]></text>
                </staticText>
            </frame>
        </band>
    </summary>

</jasperReport>
